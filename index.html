<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>English Literature Tracker with Mr. Arif</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Lora:wght@400;600&display=swap');
    
    .book-card {
      transition: all 0.3s ease;
    }
    
    .book-card:hover {
      transform: translateY(-4px);
    }
    
    .status-badge {
      transition: all 0.2s ease;
    }
    
    .modal-overlay {
      backdrop-filter: blur(4px);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full">
  <div id="app" class="w-full min-h-full"></div>
  <script>
    const defaultConfig = {
      background_color: "#1a1a2e",
      card_color: "#16213e",
      text_color: "#eaeaea",
      primary_action_color: "#0f4c75",
      secondary_action_color: "#3282b8",
      main_title: "English Literature with Mr. Arif",
      welcome_text: "Track your reading progress and share your thoughts",
      footer_text: "¬© 2024 Mr. Arif's English Literature Class",
      font_family: "Lora",
      font_size: 16
    };

    const literaryWorks = [
      { id: "1984", title: "1984", author: "George Orwell", genre: "Dystopian Fiction", emoji: "üëÅÔ∏è" },
      { id: "crucible", title: "The Crucible", author: "Arthur Miller", genre: "Historical Drama", emoji: "‚öñÔ∏è" },
      { id: "persepolis", title: "Persepolis", author: "Marjane Satrapi", genre: "Graphic Memoir", emoji: "üé®" },
      { id: "noexit", title: "No Exit", author: "Jean-Paul Sartre", genre: "Existential Drama", emoji: "üö™" },
      { id: "godot", title: "Waiting for Godot", author: "Samuel Beckett", genre: "Absurdist Drama", emoji: "‚è≥" },
      { id: "things", title: "Things Fall Apart", author: "Chinua Achebe", genre: "Post-Colonial Fiction", emoji: "üåç" },
      { id: "hamlet", title: "Hamlet", author: "William Shakespeare", genre: "Tragedy", emoji: "üíÄ" },
      { id: "macbeth", title: "Macbeth", author: "William Shakespeare", genre: "Tragedy", emoji: "üëë" },
      { id: "midsummer", title: "A Midsummer Night's Dream", author: "William Shakespeare", genre: "Comedy", emoji: "üßö" },
      { id: "romeo", title: "Romeo and Juliet", author: "William Shakespeare", genre: "Tragedy", emoji: "üíî" }
    ];

    let userProgress = [];
    let currentModal = null;
    let isLoading = false;

    const dataHandler = {
      onDataChanged(data) {
        userProgress = data;
        renderBooks();
      }
    };

    async function initApp() {
      const result = await window.dataSdk.init(dataHandler);
      if (!result.isOk) {
        console.error("Failed to initialize data SDK");
      }
    }

    function getBookProgress(bookId) {
      return userProgress.find(p => p.book_id === bookId);
    }

    function getStatusColor(status, config) {
      const secondaryActionColor = config.secondary_action_color || defaultConfig.secondary_action_color;
      if (status === 'completed') return '#10b981';
      if (status === 'reading') return '#f59e0b';
      if (status === 'to-read') return secondaryActionColor;
      return 'transparent';
    }

    function getStatusText(status) {
      if (status === 'completed') return '‚úì Completed';
      if (status === 'reading') return 'üìñ Reading';
      if (status === 'to-read') return 'üìö To Read';
      return 'Not Started';
    }

    async function updateBookStatus(book, status) {
      if (isLoading) return;
      
      const progress = getBookProgress(book.id);
      isLoading = true;
      renderBooks();
      
      if (progress) {
        progress.status = status;
        progress.updated_at = new Date().toISOString();
        const result = await window.dataSdk.update(progress);
        if (!result.isOk) {
          showToast("Failed to update status. Please try again.");
        }
      } else {
        if (userProgress.length >= 999) {
          showToast("Maximum limit of 999 books reached.");
          isLoading = false;
          renderBooks();
          return;
        }
        
        const newProgress = {
          book_id: book.id,
          status: status,
          notes: "",
          rating: 0,
          updated_at: new Date().toISOString()
        };
        const result = await window.dataSdk.create(newProgress);
        if (!result.isOk) {
          showToast("Failed to save progress. Please try again.");
        }
      }
      
      isLoading = false;
      renderBooks();
    }

    function openNotesModal(book) {
      currentModal = book.id;
      renderBooks();
    }

    function closeModal() {
      currentModal = null;
      renderBooks();
    }

    async function saveNotes(book) {
      if (isLoading) return;
      
      const notesInput = document.getElementById('notes-input');
      const ratingSelect = document.getElementById('rating-select');
      const notes = notesInput.value;
      const rating = parseInt(ratingSelect.value);
      
      const progress = getBookProgress(book.id);
      isLoading = true;
      
      const saveBtn = document.getElementById('save-notes-btn');
      saveBtn.textContent = 'Saving...';
      saveBtn.disabled = true;
      
      if (progress) {
        progress.notes = notes;
        progress.rating = rating;
        progress.updated_at = new Date().toISOString();
        const result = await window.dataSdk.update(progress);
        if (result.isOk) {
          showToast("Notes saved successfully!");
          closeModal();
        } else {
          showToast("Failed to save notes. Please try again.");
        }
      } else {
        if (userProgress.length >= 999) {
          showToast("Maximum limit of 999 books reached.");
          isLoading = false;
          saveBtn.textContent = 'Save Notes';
          saveBtn.disabled = false;
          return;
        }
        
        const newProgress = {
          book_id: book.id,
          status: "to-read",
          notes: notes,
          rating: rating,
          updated_at: new Date().toISOString()
        };
        const result = await window.dataSdk.create(newProgress);
        if (result.isOk) {
          showToast("Notes saved successfully!");
          closeModal();
        } else {
          showToast("Failed to save notes. Please try again.");
        }
      }
      
      isLoading = false;
      saveBtn.textContent = 'Save Notes';
      saveBtn.disabled = false;
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50';
      toast.style.backgroundColor = window.elementSdk.config.primary_action_color || defaultConfig.primary_action_color;
      toast.style.color = window.elementSdk.config.text_color || defaultConfig.text_color;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    function renderBooks() {
      const config = window.elementSdk.config;
      const app = document.getElementById('app');
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'Georgia, serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const cardColor = config.card_color || defaultConfig.card_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryActionColor = config.primary_action_color || defaultConfig.primary_action_color;
      const secondaryActionColor = config.secondary_action_color || defaultConfig.secondary_action_color;
      
      app.style.backgroundColor = backgroundColor;
      app.style.color = textColor;
      app.style.fontFamily = `${customFont}, ${baseFontStack}`;
      
      const completedCount = userProgress.filter(p => p.status === 'completed').length;
      const readingCount = userProgress.filter(p => p.status === 'reading').length;
      
      app.innerHTML = `
        <div class="w-full min-h-full px-6 py-12">
          <header class="text-center mb-12">
            <h1 id="main-title" class="font-bold mb-4" style="font-family: 'Playfair Display', ${customFont}, ${baseFontStack}; font-size: ${baseSize * 3}px; color: ${textColor};">
              ${config.main_title || defaultConfig.main_title}
            </h1>
            <p id="welcome-text" class="text-lg opacity-90 mb-6" style="font-size: ${baseSize * 1.25}px; color: ${textColor};">
              ${config.welcome_text || defaultConfig.welcome_text}
            </p>
            
            <div class="flex justify-center gap-6 flex-wrap">
              <div class="px-6 py-3 rounded-lg" style="background-color: ${cardColor};">
                <div style="font-size: ${baseSize * 2}px; font-weight: bold; color: ${textColor};">${completedCount}</div>
                <div style="font-size: ${baseSize * 0.875}px; opacity: 0.8; color: ${textColor};">Completed</div>
              </div>
              <div class="px-6 py-3 rounded-lg" style="background-color: ${cardColor};">
                <div style="font-size: ${baseSize * 2}px; font-weight: bold; color: ${textColor};">${readingCount}</div>
                <div style="font-size: ${baseSize * 0.875}px; opacity: 0.8; color: ${textColor};">Currently Reading</div>
              </div>
              <div class="px-6 py-3 rounded-lg" style="background-color: ${cardColor};">
                <div style="font-size: ${baseSize * 2}px; font-weight: bold; color: ${textColor};">${literaryWorks.length}</div>
                <div style="font-size: ${baseSize * 0.875}px; opacity: 0.8; color: ${textColor};">Total Books</div>
              </div>
            </div>
          </header>

          <main class="max-w-7xl mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              ${literaryWorks.map(work => {
                const progress = getBookProgress(work.id);
                const status = progress?.status || null;
                const hasNotes = progress?.notes || progress?.rating;
                
                return `
                  <div class="book-card rounded-lg shadow-lg p-6" style="background-color: ${cardColor};">
                    <div class="text-5xl mb-4 text-center">${work.emoji}</div>
                    <h2 class="font-bold mb-2" style="font-family: 'Playfair Display', ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.5}px; color: ${textColor};">
                      ${work.title}
                    </h2>
                    <p class="mb-1" style="font-size: ${baseSize}px; color: ${textColor}; opacity: 0.9;">
                      <span class="font-semibold">Author:</span> ${work.author}
                    </p>
                    <p class="inline-block px-3 py-1 rounded-full text-sm mb-4" style="font-size: ${baseSize * 0.875}px; background-color: ${secondaryActionColor}; color: ${textColor};">
                      ${work.genre}
                    </p>
                    
                    ${status ? `
                      <div class="status-badge inline-block px-3 py-1 rounded-full text-sm mb-3 font-semibold" style="font-size: ${baseSize * 0.875}px; background-color: ${getStatusColor(status, config)}; color: white;">
                        ${getStatusText(status)}
                      </div>
                    ` : ''}
                    
                    ${hasNotes ? `
                      <div class="mb-3 p-3 rounded" style="background-color: ${backgroundColor}; opacity: 0.8;">
                        ${progress.rating > 0 ? `<div class="mb-1" style="font-size: ${baseSize * 0.875}px; color: ${textColor};">‚≠ê ${progress.rating}/5</div>` : ''}
                        ${progress.notes ? `<div style="font-size: ${baseSize * 0.875}px; color: ${textColor}; font-style: italic;">"${progress.notes.substring(0, 60)}${progress.notes.length > 60 ? '...' : ''}"</div>` : ''}
                      </div>
                    ` : ''}
                    
                    <div class="flex gap-2 flex-wrap">
                      <button class="status-btn px-3 py-2 rounded text-sm font-medium" 
                              style="font-size: ${baseSize * 0.875}px; background-color: ${status === 'to-read' ? getStatusColor('to-read', config) : primaryActionColor}; color: ${textColor}; ${isLoading ? 'opacity: 0.5; cursor: not-allowed;' : ''}"
                              data-book-id="${work.id}" 
                              data-status="to-read"
                              ${isLoading ? 'disabled' : ''}>
                        To Read
                      </button>
                      <button class="status-btn px-3 py-2 rounded text-sm font-medium" 
                              style="font-size: ${baseSize * 0.875}px; background-color: ${status === 'reading' ? '#f59e0b' : primaryActionColor}; color: ${textColor}; ${isLoading ? 'opacity: 0.5; cursor: not-allowed;' : ''}"
                              data-book-id="${work.id}" 
                              data-status="reading"
                              ${isLoading ? 'disabled' : ''}>
                        Reading
                      </button>
                      <button class="status-btn px-3 py-2 rounded text-sm font-medium" 
                              style="font-size: ${baseSize * 0.875}px; background-color: ${status === 'completed' ? '#10b981' : primaryActionColor}; color: ${textColor}; ${isLoading ? 'opacity: 0.5; cursor: not-allowed;' : ''}"
                              data-book-id="${work.id}" 
                              data-status="completed"
                              ${isLoading ? 'disabled' : ''}>
                        Completed
                      </button>
                      <button class="notes-btn px-3 py-2 rounded text-sm font-medium" 
                              style="font-size: ${baseSize * 0.875}px; background-color: ${secondaryActionColor}; color: ${textColor};"
                              data-book-id="${work.id}">
                        ${hasNotes ? '‚úèÔ∏è Edit' : 'üìù Notes'}
                      </button>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          </main>

          <footer class="text-center mt-16 pt-8 border-t opacity-70" style="border-color: ${textColor}; color: ${textColor};">
            <p id="footer-text" style="font-size: ${baseSize * 0.875}px;">
              ${config.footer_text || defaultConfig.footer_text}
            </p>
          </footer>
        </div>
        
        ${currentModal ? (() => {
          const book = literaryWorks.find(b => b.id === currentModal);
          const progress = getBookProgress(book.id);
          
          return `
            <div class="modal-overlay fixed inset-0 flex items-center justify-center p-4 z-50" style="background-color: rgba(0, 0, 0, 0.7);">
              <div class="rounded-lg shadow-2xl max-w-2xl w-full max-h-[90%] overflow-y-auto p-6" style="background-color: ${cardColor};">
                <div class="flex justify-between items-start mb-4">
                  <h3 class="font-bold" style="font-family: 'Playfair Display', ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.75}px; color: ${textColor};">
                    ${book.emoji} ${book.title}
                  </h3>
                  <button id="close-modal-btn" class="text-2xl opacity-70 hover:opacity-100" style="color: ${textColor};">√ó</button>
                </div>
                
                <div class="mb-4">
                  <label for="rating-select" class="block mb-2 font-semibold" style="font-size: ${baseSize}px; color: ${textColor};">Rating</label>
                  <select id="rating-select" class="w-full px-4 py-2 rounded" style="font-size: ${baseSize}px; background-color: ${backgroundColor}; color: ${textColor}; border: 2px solid ${primaryActionColor};">
                    <option value="0" ${!progress?.rating ? 'selected' : ''}>Not rated</option>
                    <option value="1" ${progress?.rating === 1 ? 'selected' : ''}>‚≠ê 1 - Poor</option>
                    <option value="2" ${progress?.rating === 2 ? 'selected' : ''}>‚≠ê‚≠ê 2 - Fair</option>
                    <option value="3" ${progress?.rating === 3 ? 'selected' : ''}>‚≠ê‚≠ê‚≠ê 3 - Good</option>
                    <option value="4" ${progress?.rating === 4 ? 'selected' : ''}>‚≠ê‚≠ê‚≠ê‚≠ê 4 - Very Good</option>
                    <option value="5" ${progress?.rating === 5 ? 'selected' : ''}>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5 - Excellent</option>
                  </select>
                </div>
                
                <div class="mb-6">
                  <label for="notes-input" class="block mb-2 font-semibold" style="font-size: ${baseSize}px; color: ${textColor};">Notes & Reflections</label>
                  <textarea id="notes-input" rows="6" 
                            class="w-full px-4 py-3 rounded" 
                            placeholder="Share your thoughts, favorite quotes, or key themes..."
                            style="font-size: ${baseSize}px; background-color: ${backgroundColor}; color: ${textColor}; border: 2px solid ${primaryActionColor};">${progress?.notes || ''}</textarea>
                </div>
                
                <div class="flex gap-3">
                  <button id="save-notes-btn" class="px-6 py-3 rounded font-semibold flex-1" 
                          style="font-size: ${baseSize}px; background-color: ${primaryActionColor}; color: ${textColor};">
                    Save Notes
                  </button>
                  <button id="cancel-modal-btn" class="px-6 py-3 rounded font-semibold" 
                          style="font-size: ${baseSize}px; background-color: ${secondaryActionColor}; color: ${textColor};">
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          `;
        })() : ''}
      `;
      
      // Attach event listeners
      document.querySelectorAll('.status-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const bookId = e.target.dataset.bookId;
          const status = e.target.dataset.status;
          const book = literaryWorks.find(b => b.id === bookId);
          updateBookStatus(book, status);
        });
      });
      
      document.querySelectorAll('.notes-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const bookId = e.target.dataset.bookId;
          const book = literaryWorks.find(b => b.id === bookId);
          openNotesModal(book);
        });
      });
      
      if (currentModal) {
        const closeBtn = document.getElementById('close-modal-btn');
        const cancelBtn = document.getElementById('cancel-modal-btn');
        const saveBtn = document.getElementById('save-notes-btn');
        const modalOverlay = document.querySelector('.modal-overlay');
        
        if (closeBtn) closeBtn.addEventListener('click', closeModal);
        if (cancelBtn) cancelBtn.addEventListener('click', closeModal);
        if (modalOverlay) {
          modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) closeModal();
          });
        }
        if (saveBtn) {
          const book = literaryWorks.find(b => b.id === currentModal);
          saveBtn.addEventListener('click', () => saveNotes(book));
        }
      }
    }

    async function onConfigChange(config) {
      renderBooks();
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => {
              config.background_color = value;
              window.elementSdk.setConfig({ background_color: value });
            }
          },
          {
            get: () => config.card_color || defaultConfig.card_color,
            set: (value) => {
              config.card_color = value;
              window.elementSdk.setConfig({ card_color: value });
            }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => {
              config.text_color = value;
              window.elementSdk.setConfig({ text_color: value });
            }
          },
          {
            get: () => config.primary_action_color || defaultConfig.primary_action_color,
            set: (value) => {
              config.primary_action_color = value;
              window.elementSdk.setConfig({ primary_action_color: value });
            }
          },
          {
            get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
            set: (value) => {
              config.secondary_action_color = value;
              window.elementSdk.setConfig({ secondary_action_color: value });
            }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => config.font_family || defaultConfig.font_family,
          set: (value) => {
            config.font_family = value;
            window.elementSdk.setConfig({ font_family: value });
          }
        },
        fontSizeable: {
          get: () => config.font_size || defaultConfig.font_size,
          set: (value) => {
            config.font_size = value;
            window.elementSdk.setConfig({ font_size: value });
          }
        }
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ["main_title", config.main_title || defaultConfig.main_title],
        ["welcome_text", config.welcome_text || defaultConfig.welcome_text],
        ["footer_text", config.footer_text || defaultConfig.footer_text]
      ]);
    }

    window.elementSdk.init({
      defaultConfig,
      onConfigChange,
      mapToCapabilities,
      mapToEditPanelValues
    });

    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a4e800654269958',t:'MTc2NDIxMzczNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
